"use strict";(self["webpackChunkfgmusic"]=self["webpackChunkfgmusic"]||[]).push([[576],{1599:function(t,s,e){e.d(s,{A:function(){return c}});var a=function(){var t=this,s=t._self._c;return s("div",{ref:"songsListTableMain",staticClass:"main_wrap"},[s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"content",staticClass:"content",attrs:{"element-loading-background":"var(--loading-bg-color)"}},[t.showRetry?s("retry",{on:{retry:t.getData}}):t._e(),t.showRetry||t.showEmpty?t._e():s("el-scrollbar",{staticStyle:{height:"100%"},attrs:{"wrap-style":"overflow-x: hidden;"}},[s("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.getData,expression:"getData"}],staticClass:"content_i",attrs:{"infinite-scroll-immediate":"false","infinite-scroll-disabled":"infiniteDisabled"}},t._l(t.songsListData,(function(e,a){return s("div",{key:e.id,staticClass:"table_item",class:{act:e.id==t.active},on:{click:function(s){t.active=e.id},dblclick:function(s){return t.playSpecificSong(e)}}},[s("div",{directives:[{name:"show",rawName:"v-show",value:!t.visAreas.point,expression:"!visAreas.point"}],staticClass:"point"}),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.visAreas.index,expression:"!visAreas.index"}],staticClass:"index"},[t._v(t._s(a+1))]),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.visAreas.song_name,expression:"!visAreas.song_name"}],staticClass:"song_name",attrs:{title:e.songName}},[t._v(" "+t._s(e.songName)+" ")]),s("div",{staticClass:"version"},[1==e.fee?s("span",[t._v(" 试听 ")]):t._e()]),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.visAreas.col,expression:"!visAreas.col"}],staticClass:"col",on:{click:function(s){return t.toggleCol(e)}}},[s("div",{staticClass:"i_wrapper"},[s("i",{staticClass:"iconfont",class:{"icon-xihuan1":!e.isCol,"icon-xihuan2":e.isCol}})])]),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.visAreas.download,expression:"!visAreas.download"}],staticClass:"download",on:{click:function(s){return t.download(e)}}},[s("div",{staticClass:"i_wrapper"},[s("i",{staticClass:"iconfont icon-arrow-down-line"})])]),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.visAreas.artist,expression:"!visAreas.artist"}],staticClass:"artist",attrs:{title:e.arName}},[t._v(" "+t._s(e.arName)+" ")]),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.visAreas.albumName,expression:"!visAreas.albumName"}],staticClass:"albumName",attrs:{title:e.albumName}},[t._v(" "+t._s(e.album)+" ")]),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.visAreas.duration,expression:"!visAreas.duration"}],staticClass:"duration"},[t._v(" "+t._s(t.formatTime(e.dt))+" ")])])})),0)]),!t.showEmpty||t.showRetry||t.loading?t._e():s("div",{staticClass:"empty"},[s("div",{staticClass:"empty_i"},[t._v("没有数据")])])],1)])},i=[],n=(e(4114),e(8992),e(3215),e(4520),e(2577),e(3949),e(1454),e(7550),e(9335)),o={name:"SongsListTable",props:{visAreas:{type:Object,default:()=>({})},opts:{type:Object,default:()=>({id:0,type:"",keywords:""})}},data(){return{songsListData:[],active:0,loading:!1,showRetry:!1,showEmpty:!1,infiniteDisabled:!1,limit:30,offset:0,keywords:"",lastLoadCount:0}},watch:{opts:{handler(t){this.songsListData=[],this.getData(),this.keywords=t.keywords,this.lastLoadCount=0},immediate:!0}},computed:{...(0,n.mapGetters)(["playQueue","downloadList","settings","selectedTrackId"])},methods:{...(0,n.mapActions)(["pushToPlaylist","updateCurrentTrack","addToDownloadList"]),formatTime(t){const s=Math.floor(t/36e5),e=Math.floor(t%36e5/6e4),a=Math.floor(t%6e4/1e3);return`${String(s).padStart(2,"0")}:${String(e).padStart(2,"0")}:${String(a).padStart(2,"0")}`},arNameFormatted(t){let s="";const e=t.map((t=>t.name));return s=e.length>3?"群星":e.join(" & "),s},async getData(){this.loading=!0,this.showEmpty=!1,this.showRetry=!1;const t=this.opts;try{switch(t.type){case"col":this.infiniteDisabled=!0,this.getShowColData();break;case"toplist":this.infiniteDisabled=!0,await this.getToplistData(t.id);break;case"search":t.keywords&&await this.getSearchData(t.keywords);break;default:this.$message.error("传入参数错误！")}}catch(s){console.error(s),this.showRetry=!0,this.$message.error("获取榜单数据失败！")}this.loading=!1,this.songsListData.length||(this.showEmpty=!0)},async getToplistData(t){if(0==t)return;const{data:s}=await this.$http.get("/playlist/detail",{params:{id:t}}),e=s.playlist.trackIds.map((t=>t.id)),{data:a}=await this.$http.get("song/detail",{params:{ids:e.join(",")}});let i=a.songs.map((t=>({id:t.id,picUrl:t.al.picUrl,songName:t.name,arName:this.arNameFormatted(t.ar),album:t.al.name,dt:t.dt,isPlayable:!0,isCol:this.checkIsCol(t),fee:t.fee})));this.settings?.playSettings?.ignorePreviewTracks&&(i=i.filter((t=>1!==t.fee))),this.songsListData=i},async getSearchData(t){if(""==t.trim())return;this.keywords!==t&&(this.songsListData=[],this.offset=0);const s="/cloudsearch",e={limit:this.limit,offset:this.offset,type:1,keywords:t};let{data:a}=await this.$http.get(s,{params:e});a=a.result.songs||[];let i=a.map((t=>({id:t.id,picUrl:t.al.picUrl,songName:t.name,arName:this.arNameFormatted(t.ar),album:t.al.name,dt:t.dt,isPlayable:!0,isCol:this.checkIsCol(t),fee:t.fee}))),n=this.filterUniqueItems(this.songsListData,i);n.length||(this.infiniteDisabled=!0),this.offset+=this.limit,this.settings?.playSettings?.ignorePreviewTracks?(n=n.filter((t=>1!==t.fee)),this.songsListData.push(...n),n.length||this.infiniteDisabled||this.getData()):this.songsListData.push(...n)},getShowColData(){const t=JSON.parse(localStorage.getItem("myCol")||"{}"),s=t.songs||[];this.songsListData=s},async download(t){if(await this.checkPlayable([t]),!t.url)return this.$message.error("URL为空");const s={name:t.songName,id:t.id,url:t.url};let e="是否下载？",a=()=>{this.addToDownloadList(s),this.$message.success("添加至下载列表！")};if(t.freeTrialInfo.end){const s=t.freeTrialInfo.end-t.freeTrialInfo.start;e="该歌曲为试听版，是否继续下载？时长"+s+"秒"}const i=this.downloadList.findIndex((s=>s.id==t.id));-1!==i&&(e="下载列表已经存在，是否重复下载"),this.$confirm(e,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"messageBox"}).then(a).catch((()=>{}))},async playSpecificSong(t){try{await this.checkPlayable(this.songsListData)}catch(e){return this.$message.error("获取歌曲详情失败！")}if(!t.isPlayable)return this.$message.error("无法播放！");const s=this.eqArr(this.songsListData,this.playQueue);s||this.pushToPlaylist([...this.songsListData]),t.id==this.selectedTrackId?this.updateCurrentTrack(-2):this.updateCurrentTrack(t.id)},async checkPlayable(t){let s=[];this.lastLoadCount&&(s=t.slice(this.lastLoadCount),t=s);const e=t.map((t=>t.id)).join(","),a="/song/url";let{data:i}=await this.$http.get(a,{params:{id:e}});i=i.data,t.forEach((t=>{const s=i.find((s=>t.id==s.id));t.url=s.url,t.freeTrialInfo=s.freeTrialInfo||{},t.url||(t.isPlayable=!1)})),this.lastLoadCount+=t.length},checkIsCol(t){let s=localStorage.getItem("myCol");return!!s&&(s=JSON.parse(s),!!s.songs&&s.songs.some((s=>s.id===t.id)))},toggleCol(t){let s=JSON.parse(localStorage.getItem("myCol")||"{}");s.songs||(s.songs=[]);const e=s.songs.findIndex((s=>s.id==t.id));t.isCol?(s.songs.splice(e,1),t.isCol=!1,this.$message.success("取消收藏成功！")):(s.songs.push(t),t.isCol=!0,this.$message.success("添加收藏成功！")),localStorage.setItem("myCol",JSON.stringify(s))},eqArr(t,s){return t.length===s.length&&t.every(((t,e)=>t.id===s[e].id))},filterUniqueItems(t,s){const e=s.filter((s=>!t.some((t=>t.id===s.id))));return e}}},r=o,l=e(1656),d=(0,l.A)(r,a,i,!1,null,"4a2fc9ff",null),c=d.exports},7576:function(t,s,e){e.r(s),e.d(s,{default:function(){return h}});var a=function(){var t=this,s=t._self._c;return s("div",{staticClass:"ranking_main"},[s("div",{staticClass:"header"},[s("div",{staticClass:"menu_wrapper"},[s("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"default-active":t.active,mode:"horizontal"},on:{select:t.toggleRanking}},t._l(t.navData,(function(e){return s("el-menu-item",{key:e.id,attrs:{index:e.id+""}},[t._v(t._s(e.title))])})),1)],1)]),s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"content",attrs:{"element-loading-background":"var(--loading-bg-color)"}},[t.showRetry?s("retry",{on:{retry:t.getData}}):t._e(),t.showContent?s("songs-list-table",{attrs:{visAreas:{point:!0},opts:{type:"toplist",id:t.toplistOpts[t.active-0]}}}):t._e()],1)])},i=[],n=(e(4114),e(8992),e(2577),e(1599)),o=e(1617),r={name:"Ranking",components:{SongsListTable:n.A,Retry:o.A},data(){return{active:"0",showRetry:!1,showContent:!1,loading:!1,navData:[{id:0,title:"热歌榜"},{id:1,title:"飙升榜"},{id:2,title:"网络榜"},{id:3,title:"说唱榜"},{id:4,title:"古典榜"},{id:5,title:"热度榜"},{id:6,title:"日语榜"},{id:7,title:"欧美榜"}],toplistOpts:[]}},created(){this.getData()},methods:{toggleRanking(t){this.active=t},async getData(){this.showRetry=!1,this.loading=!0;try{await this.getNavData(),this.showContent=!0}catch(t){console.error(t),this.showRetry=!0,this.$message.error("获取导航数据失败！")}this.loading=!1},async getNavData(){const t="/toplist";let{data:s}=await this.$http.get(t);s=s.list,this.toplistOpts.push(s.find((t=>"热歌榜"===t.name)).id),this.toplistOpts.push(s.find((t=>"飙升榜"===t.name)).id),this.toplistOpts.push(s.find((t=>"网络热歌榜"===t.name)).id),this.toplistOpts.push(s.find((t=>"云音乐说唱榜"===t.name)).id),this.toplistOpts.push(s.find((t=>"云音乐古典榜"===t.name)).id),this.toplistOpts.push(s.find((t=>"实时热度榜"===t.name)).id),this.toplistOpts.push(s.find((t=>"云音乐日语榜"===t.name)).id),this.toplistOpts.push(s.find((t=>"云音乐欧美热歌榜"===t.name)).id)}}},l=r,d=e(1656),c=(0,d.A)(l,a,i,!1,null,"fcf9cd18",null),h=c.exports}}]);
//# sourceMappingURL=576.0b870519.js.map