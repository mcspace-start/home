"use strict";(self["webpackChunkfgmusic"]=self["webpackChunkfgmusic"]||[]).push([[253],{1599:function(t,s,e){e.d(s,{A:function(){return d}});var a=function(){var t=this,s=t._self._c;return s("div",{ref:"songsListTableMain",staticClass:"main_wrap"},[s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"content",staticClass:"content",attrs:{"element-loading-background":"var(--loading-bg-color)"}},[t.showRetry?s("retry",{on:{retry:t.getData}}):t._e(),t.showRetry||t.showEmpty?t._e():s("el-scrollbar",{staticStyle:{height:"100%"},attrs:{"wrap-style":"overflow-x: hidden;"}},[s("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.getData,expression:"getData"}],staticClass:"content_i",attrs:{"infinite-scroll-immediate":"false","infinite-scroll-disabled":"infiniteDisabled"}},t._l(t.songsListData,(function(e,a){return s("div",{key:e.id,staticClass:"table_item",class:{act:e.id==t.active},on:{click:function(s){t.active=e.id},dblclick:function(s){return t.playSpecificSong(e)}}},[s("div",{directives:[{name:"show",rawName:"v-show",value:!t.visAreas.point,expression:"!visAreas.point"}],staticClass:"point"}),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.visAreas.index,expression:"!visAreas.index"}],staticClass:"index"},[t._v(t._s(a+1))]),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.visAreas.song_name,expression:"!visAreas.song_name"}],staticClass:"song_name",attrs:{title:e.songName}},[t._v(" "+t._s(e.songName)+" ")]),s("div",{staticClass:"version"},[1==e.fee?s("span",[t._v(" 试听 ")]):t._e()]),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.visAreas.col,expression:"!visAreas.col"}],staticClass:"col",on:{click:function(s){return t.toggleCol(e)}}},[s("div",{staticClass:"i_wrapper"},[s("i",{staticClass:"iconfont",class:{"icon-xihuan1":!e.isCol,"icon-xihuan2":e.isCol}})])]),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.visAreas.download,expression:"!visAreas.download"}],staticClass:"download",on:{click:function(s){return t.download(e)}}},[s("div",{staticClass:"i_wrapper"},[s("i",{staticClass:"iconfont icon-arrow-down-line"})])]),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.visAreas.artist,expression:"!visAreas.artist"}],staticClass:"artist",attrs:{title:e.arName}},[t._v(" "+t._s(e.arName)+" ")]),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.visAreas.albumName,expression:"!visAreas.albumName"}],staticClass:"albumName",attrs:{title:e.albumName}},[t._v(" "+t._s(e.album)+" ")]),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.visAreas.duration,expression:"!visAreas.duration"}],staticClass:"duration"},[t._v(" "+t._s(t.formatTime(e.dt))+" ")])])})),0)]),!t.showEmpty||t.showRetry||t.loading?t._e():s("div",{staticClass:"empty"},[s("div",{staticClass:"empty_i"},[t._v("没有数据")])])],1)])},i=[],o=(e(4114),e(8992),e(3215),e(4520),e(2577),e(3949),e(1454),e(7550),e(9335)),l={name:"SongsListTable",props:{visAreas:{type:Object,default:()=>({})},opts:{type:Object,default:()=>({id:0,type:"",keywords:""})}},data(){return{songsListData:[],active:0,loading:!1,showRetry:!1,showEmpty:!1,infiniteDisabled:!1,limit:30,offset:0,keywords:"",lastLoadCount:0}},watch:{opts:{handler(t){this.songsListData=[],this.getData(),this.keywords=t.keywords,this.lastLoadCount=0},immediate:!0}},computed:{...(0,o.mapGetters)(["playQueue","downloadList","settings","selectedTrackId"])},methods:{...(0,o.mapActions)(["pushToPlaylist","updateCurrentTrack","addToDownloadList"]),formatTime(t){const s=Math.floor(t/36e5),e=Math.floor(t%36e5/6e4),a=Math.floor(t%6e4/1e3);return`${String(s).padStart(2,"0")}:${String(e).padStart(2,"0")}:${String(a).padStart(2,"0")}`},arNameFormatted(t){let s="";const e=t.map((t=>t.name));return s=e.length>3?"群星":e.join(" & "),s},async getData(){this.loading=!0,this.showEmpty=!1,this.showRetry=!1;const t=this.opts;try{switch(t.type){case"col":this.infiniteDisabled=!0,this.getShowColData();break;case"toplist":this.infiniteDisabled=!0,await this.getToplistData(t.id);break;case"search":t.keywords&&await this.getSearchData(t.keywords);break;default:this.$message.error("传入参数错误！")}}catch(s){console.error(s),this.showRetry=!0,this.$message.error("获取榜单数据失败！")}this.loading=!1,this.songsListData.length||(this.showEmpty=!0)},async getToplistData(t){if(0==t)return;const{data:s}=await this.$http.get("/playlist/detail",{params:{id:t}}),e=s.playlist.trackIds.map((t=>t.id)),{data:a}=await this.$http.get("song/detail",{params:{ids:e.join(",")}});let i=a.songs.map((t=>({id:t.id,picUrl:t.al.picUrl,songName:t.name,arName:this.arNameFormatted(t.ar),album:t.al.name,dt:t.dt,isPlayable:!0,isCol:this.checkIsCol(t),fee:t.fee})));this.settings?.playSettings?.ignorePreviewTracks&&(i=i.filter((t=>1!==t.fee))),this.songsListData=i},async getSearchData(t){if(""==t.trim())return;this.keywords!==t&&(this.songsListData=[],this.offset=0);const s="/cloudsearch",e={limit:this.limit,offset:this.offset,type:1,keywords:t};let{data:a}=await this.$http.get(s,{params:e});a=a.result.songs||[];let i=a.map((t=>({id:t.id,picUrl:t.al.picUrl,songName:t.name,arName:this.arNameFormatted(t.ar),album:t.al.name,dt:t.dt,isPlayable:!0,isCol:this.checkIsCol(t),fee:t.fee}))),o=this.filterUniqueItems(this.songsListData,i);o.length||(this.infiniteDisabled=!0),this.offset+=this.limit,this.settings?.playSettings?.ignorePreviewTracks?(o=o.filter((t=>1!==t.fee)),this.songsListData.push(...o),o.length||this.infiniteDisabled||this.getData()):this.songsListData.push(...o)},getShowColData(){const t=JSON.parse(localStorage.getItem("myCol")||"{}"),s=t.songs||[];this.songsListData=s},async download(t){if(await this.checkPlayable([t]),!t.url)return this.$message.error("URL为空");const s={name:t.songName,id:t.id,url:t.url};let e="是否下载？",a=()=>{this.addToDownloadList(s),this.$message.success("添加至下载列表！")};if(t.freeTrialInfo.end){const s=t.freeTrialInfo.end-t.freeTrialInfo.start;e="该歌曲为试听版，是否继续下载？时长"+s+"秒"}const i=this.downloadList.findIndex((s=>s.id==t.id));-1!==i&&(e="下载列表已经存在，是否重复下载"),this.$confirm(e,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"messageBox"}).then(a).catch((()=>{}))},async playSpecificSong(t){try{await this.checkPlayable(this.songsListData)}catch(e){return this.$message.error("获取歌曲详情失败！")}if(!t.isPlayable)return this.$message.error("无法播放！");const s=this.eqArr(this.songsListData,this.playQueue);s||this.pushToPlaylist([...this.songsListData]),t.id==this.selectedTrackId?this.updateCurrentTrack(-2):this.updateCurrentTrack(t.id)},async checkPlayable(t){let s=[];this.lastLoadCount&&(s=t.slice(this.lastLoadCount),t=s);const e=t.map((t=>t.id)).join(","),a="/song/url";let{data:i}=await this.$http.get(a,{params:{id:e}});i=i.data,t.forEach((t=>{const s=i.find((s=>t.id==s.id));t.url=s.url,t.freeTrialInfo=s.freeTrialInfo||{},t.url||(t.isPlayable=!1)})),this.lastLoadCount+=t.length},checkIsCol(t){let s=localStorage.getItem("myCol");return!!s&&(s=JSON.parse(s),!!s.songs&&s.songs.some((s=>s.id===t.id)))},toggleCol(t){let s=JSON.parse(localStorage.getItem("myCol")||"{}");s.songs||(s.songs=[]);const e=s.songs.findIndex((s=>s.id==t.id));t.isCol?(s.songs.splice(e,1),t.isCol=!1,this.$message.success("取消收藏成功！")):(s.songs.push(t),t.isCol=!0,this.$message.success("添加收藏成功！")),localStorage.setItem("myCol",JSON.stringify(s))},eqArr(t,s){return t.length===s.length&&t.every(((t,e)=>t.id===s[e].id))},filterUniqueItems(t,s){const e=s.filter((s=>!t.some((t=>t.id===s.id))));return e}}},n=l,r=e(1656),c=(0,r.A)(n,a,i,!1,null,"4a2fc9ff",null),d=c.exports},1253:function(t,s,e){e.r(s),e.d(s,{default:function(){return m}});var a=function(){var t=this,s=t._self._c;return s("div",{staticClass:"col_main"},[s("div",{staticClass:"left"},[s("div",{staticClass:"head"},[s("div",{staticClass:"title"},[t._v("收藏"+t._s(t.compLabelMap[t.activeComp]))]),s("div",{staticClass:"buttons"},[s("div",{staticClass:"btn",on:{click:t.handleClear}},[t._v(" 清空"+t._s(t.compLabelMap[t.activeComp])+" ")])])]),s("div",{staticClass:"content"},[s(t.activeComp,{key:t.key,tag:"component",attrs:{opts:{type:"col"},visAreas:t.visAreas}})],1)]),s("div",{staticClass:"right"},[s("div",{staticClass:"menu_wrapper"},[s("el-menu",{attrs:{"default-active":"SongsListTable"},on:{select:t.handleSelect}},[s("el-menu-item",{attrs:{index:"SongsListTable"}},[s("span",{attrs:{slot:"title"},slot:"title"},[t._v("收藏歌曲")])]),s("el-menu-item",{attrs:{index:"ArtistsList"}},[s("span",{attrs:{slot:"title"},slot:"title"},[t._v("收藏歌手")])]),s("el-menu-item",{attrs:{index:"Playlist"}},[s("span",{attrs:{slot:"title"},slot:"title"},[t._v("收藏歌单")])])],1)],1)])])},i=[],o=e(1599),l=e(3146),n=e(5486),r={name:"Collection",components:{SongsListTable:o.A,ArtistsList:l["default"],Playlist:n["default"]},data(){return{visAreas:{duration:!0},activeComp:"SongsListTable",key:0,compLabelMap:{SongsListTable:"歌曲",ArtistsList:"歌手",Playlist:"歌单"}}},methods:{handleSelect(t){switch(this.visAreas={},t){case"SongsListTable":this.visAreas={duration:!0};break;case"ArtistsList":this.visAreas={head:!0};break;case"Playlist":this.visAreas={head:!0,tags:!0,max:!0};break}this.activeComp=t},handleClear(){switch(this.activeComp){case"SongsListTable":this.clearColSongs();break;case"ArtistsList":this.clearColArtists();break;case"Playlist":this.clearPlaylists();break;default:break}},clearColSongs(){const t=JSON.parse(localStorage.getItem("myCol")||"{}");t.songs&&0!==t.songs.length&&this.$confirm("确定清空收藏歌曲吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"messageBox"}).then((()=>{this.$message.info("收藏歌曲已清空"),t.songs=[],localStorage.setItem("myCol",JSON.stringify(t)),this.key++,this.key>1e3&&(this.key=0)})).catch((()=>{}))},clearColArtists(){const t=JSON.parse(localStorage.getItem("myCol")||"{}");t.songs&&0!==t.artists.length&&this.$confirm("确定清空收藏歌手吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",customClass:"messageBox",type:"warning"}).then((()=>{this.$message.info("收藏歌手已清空"),t.artists=[],localStorage.setItem("myCol",JSON.stringify(t)),this.key++,this.key>1e3&&(this.key=0)})).catch((()=>{}))},clearPlaylists(){const t=JSON.parse(localStorage.getItem("myCol")||"{}");0!=t.playlists.length&&this.$confirm("确定清空收藏歌单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"messageBox"}).then((()=>{this.$message.info("收藏歌单已清空"),t.playlists=[],localStorage.setItem("myCol",JSON.stringify(t)),this.key++,this.key>1e3&&(this.key=0)})).catch((()=>{}))}}},c=r,d=e(1656),h=(0,d.A)(c,a,i,!1,null,"06dd5c46",null),m=h.exports}}]);
//# sourceMappingURL=253.558af97e.js.map