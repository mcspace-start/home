"use strict";(self["webpackChunkfgmusic"]=self["webpackChunkfgmusic"]||[]).push([[777],{4777:function(s,t,e){e.r(t),e.d(t,{default:function(){return d}});var a=function(){var s=this,t=s._self._c;return t("div",{staticClass:"search_main"},[t("div",{staticClass:"head"},[t("div",{staticClass:"search_title"},[s._v("搜歌曲："+s._s(s.keywords))])]),t("div",{staticClass:"content"},[t("songs-list-table",{attrs:{visAreas:{duration:!0},opts:{type:"search",keywords:s.keywords}}})],1)])},i=[],o=e(1599),r={name:"SearchResult",components:{SongsListTable:o.A},data(){return{keywords:"逆战"}},watch:{"$route.query":{handler(s){this.keywords=s.keywords},immediate:!0}}},n=r,l=e(1656),c=(0,l.A)(n,a,i,!1,null,"6855cabc",null),d=c.exports},1599:function(s,t,e){e.d(t,{A:function(){return d}});var a=function(){var s=this,t=s._self._c;return t("div",{ref:"songsListTableMain",staticClass:"main_wrap"},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:s.loading,expression:"loading"}],ref:"content",staticClass:"content",attrs:{"element-loading-background":"var(--loading-bg-color)"}},[s.showRetry?t("retry",{on:{retry:s.getData}}):s._e(),s.showRetry||s.showEmpty?s._e():t("el-scrollbar",{staticStyle:{height:"100%"},attrs:{"wrap-style":"overflow-x: hidden;"}},[t("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:s.getData,expression:"getData"}],staticClass:"content_i",attrs:{"infinite-scroll-immediate":"false","infinite-scroll-disabled":"infiniteDisabled"}},s._l(s.songsListData,(function(e,a){return t("div",{key:e.id,staticClass:"table_item",class:{act:e.id==s.active},on:{click:function(t){s.active=e.id},dblclick:function(t){return s.playSpecificSong(e)}}},[t("div",{directives:[{name:"show",rawName:"v-show",value:!s.visAreas.point,expression:"!visAreas.point"}],staticClass:"point"}),t("div",{directives:[{name:"show",rawName:"v-show",value:!s.visAreas.index,expression:"!visAreas.index"}],staticClass:"index"},[s._v(s._s(a+1))]),t("div",{directives:[{name:"show",rawName:"v-show",value:!s.visAreas.song_name,expression:"!visAreas.song_name"}],staticClass:"song_name",attrs:{title:e.songName}},[s._v(" "+s._s(e.songName)+" ")]),t("div",{staticClass:"version"},[1==e.fee?t("span",[s._v(" 试听 ")]):s._e()]),t("div",{directives:[{name:"show",rawName:"v-show",value:!s.visAreas.col,expression:"!visAreas.col"}],staticClass:"col",on:{click:function(t){return s.toggleCol(e)}}},[t("div",{staticClass:"i_wrapper"},[t("i",{staticClass:"iconfont",class:{"icon-xihuan1":!e.isCol,"icon-xihuan2":e.isCol}})])]),t("div",{directives:[{name:"show",rawName:"v-show",value:!s.visAreas.download,expression:"!visAreas.download"}],staticClass:"download",on:{click:function(t){return s.download(e)}}},[t("div",{staticClass:"i_wrapper"},[t("i",{staticClass:"iconfont icon-arrow-down-line"})])]),t("div",{directives:[{name:"show",rawName:"v-show",value:!s.visAreas.artist,expression:"!visAreas.artist"}],staticClass:"artist",attrs:{title:e.arName}},[s._v(" "+s._s(e.arName)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:!s.visAreas.albumName,expression:"!visAreas.albumName"}],staticClass:"albumName",attrs:{title:e.albumName}},[s._v(" "+s._s(e.album)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:!s.visAreas.duration,expression:"!visAreas.duration"}],staticClass:"duration"},[s._v(" "+s._s(s.formatTime(e.dt))+" ")])])})),0)]),!s.showEmpty||s.showRetry||s.loading?s._e():t("div",{staticClass:"empty"},[t("div",{staticClass:"empty_i"},[s._v("没有数据")])])],1)])},i=[],o=(e(4114),e(8992),e(3215),e(4520),e(2577),e(3949),e(1454),e(7550),e(9335)),r={name:"SongsListTable",props:{visAreas:{type:Object,default:()=>({})},opts:{type:Object,default:()=>({id:0,type:"",keywords:""})}},data(){return{songsListData:[],active:0,loading:!1,showRetry:!1,showEmpty:!1,infiniteDisabled:!1,limit:30,offset:0,keywords:"",lastLoadCount:0}},watch:{opts:{handler(s){this.songsListData=[],this.getData(),this.keywords=s.keywords,this.lastLoadCount=0},immediate:!0}},computed:{...(0,o.mapGetters)(["playQueue","downloadList","settings","selectedTrackId"])},methods:{...(0,o.mapActions)(["pushToPlaylist","updateCurrentTrack","addToDownloadList"]),formatTime(s){const t=Math.floor(s/36e5),e=Math.floor(s%36e5/6e4),a=Math.floor(s%6e4/1e3);return`${String(t).padStart(2,"0")}:${String(e).padStart(2,"0")}:${String(a).padStart(2,"0")}`},arNameFormatted(s){let t="";const e=s.map((s=>s.name));return t=e.length>3?"群星":e.join(" & "),t},async getData(){this.loading=!0,this.showEmpty=!1,this.showRetry=!1;const s=this.opts;try{switch(s.type){case"col":this.infiniteDisabled=!0,this.getShowColData();break;case"toplist":this.infiniteDisabled=!0,await this.getToplistData(s.id);break;case"search":s.keywords&&await this.getSearchData(s.keywords);break;default:this.$message.error("传入参数错误！")}}catch(t){console.error(t),this.showRetry=!0,this.$message.error("获取榜单数据失败！")}this.loading=!1,this.songsListData.length||(this.showEmpty=!0)},async getToplistData(s){if(0==s)return;const{data:t}=await this.$http.get("/playlist/detail",{params:{id:s}}),e=t.playlist.trackIds.map((s=>s.id)),{data:a}=await this.$http.get("song/detail",{params:{ids:e.join(",")}});let i=a.songs.map((s=>({id:s.id,picUrl:s.al.picUrl,songName:s.name,arName:this.arNameFormatted(s.ar),album:s.al.name,dt:s.dt,isPlayable:!0,isCol:this.checkIsCol(s),fee:s.fee})));this.settings?.playSettings?.ignorePreviewTracks&&(i=i.filter((s=>1!==s.fee))),this.songsListData=i},async getSearchData(s){if(""==s.trim())return;this.keywords!==s&&(this.songsListData=[],this.offset=0);const t="/cloudsearch",e={limit:this.limit,offset:this.offset,type:1,keywords:s};let{data:a}=await this.$http.get(t,{params:e});a=a.result.songs||[];let i=a.map((s=>({id:s.id,picUrl:s.al.picUrl,songName:s.name,arName:this.arNameFormatted(s.ar),album:s.al.name,dt:s.dt,isPlayable:!0,isCol:this.checkIsCol(s),fee:s.fee}))),o=this.filterUniqueItems(this.songsListData,i);o.length||(this.infiniteDisabled=!0),this.offset+=this.limit,this.settings?.playSettings?.ignorePreviewTracks?(o=o.filter((s=>1!==s.fee)),this.songsListData.push(...o),o.length||this.infiniteDisabled||this.getData()):this.songsListData.push(...o)},getShowColData(){const s=JSON.parse(localStorage.getItem("myCol")||"{}"),t=s.songs||[];this.songsListData=t},async download(s){if(await this.checkPlayable([s]),!s.url)return this.$message.error("URL为空");const t={name:s.songName,id:s.id,url:s.url};let e="是否下载？",a=()=>{this.addToDownloadList(t),this.$message.success("添加至下载列表！")};if(s.freeTrialInfo.end){const t=s.freeTrialInfo.end-s.freeTrialInfo.start;e="该歌曲为试听版，是否继续下载？时长"+t+"秒"}const i=this.downloadList.findIndex((t=>t.id==s.id));-1!==i&&(e="下载列表已经存在，是否重复下载"),this.$confirm(e,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"messageBox"}).then(a).catch((()=>{}))},async playSpecificSong(s){try{await this.checkPlayable(this.songsListData)}catch(e){return this.$message.error("获取歌曲详情失败！")}if(!s.isPlayable)return this.$message.error("无法播放！");const t=this.eqArr(this.songsListData,this.playQueue);t||this.pushToPlaylist([...this.songsListData]),s.id==this.selectedTrackId?this.updateCurrentTrack(-2):this.updateCurrentTrack(s.id)},async checkPlayable(s){let t=[];this.lastLoadCount&&(t=s.slice(this.lastLoadCount),s=t);const e=s.map((s=>s.id)).join(","),a="/song/url";let{data:i}=await this.$http.get(a,{params:{id:e}});i=i.data,s.forEach((s=>{const t=i.find((t=>s.id==t.id));s.url=t.url,s.freeTrialInfo=t.freeTrialInfo||{},s.url||(s.isPlayable=!1)})),this.lastLoadCount+=s.length},checkIsCol(s){let t=localStorage.getItem("myCol");return!!t&&(t=JSON.parse(t),!!t.songs&&t.songs.some((t=>t.id===s.id)))},toggleCol(s){let t=JSON.parse(localStorage.getItem("myCol")||"{}");t.songs||(t.songs=[]);const e=t.songs.findIndex((t=>t.id==s.id));s.isCol?(t.songs.splice(e,1),s.isCol=!1,this.$message.success("取消收藏成功！")):(t.songs.push(s),s.isCol=!0,this.$message.success("添加收藏成功！")),localStorage.setItem("myCol",JSON.stringify(t))},eqArr(s,t){return s.length===t.length&&s.every(((s,e)=>s.id===t[e].id))},filterUniqueItems(s,t){const e=t.filter((t=>!s.some((s=>s.id===t.id))));return e}}},n=r,l=e(1656),c=(0,l.A)(n,a,i,!1,null,"4a2fc9ff",null),d=c.exports}}]);
//# sourceMappingURL=777.cd834b8e.js.map