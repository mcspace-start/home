<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Áæä‰∫Ü‰∏™Áæä</title>
    <link rel="shortcut icon" href="../../favicon.ico" type="image/x-icon" />
    <script src="js/vue.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script> -->
    <style>
        body,
        html,
        div,
        span,
        ul,
        li,
        input,
        p {
            padding: 0;
            margin: 0;
            list-style: none;
            -webkit-tap-highlight-color: transparent;
        }

        #app {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            /* background-color: #c3ff8b; */
            background: url("./img/bg.png") repeat;
        }

        .main {
            user-select: none;
            width: 348px;
            height: 644px;
        }

        .warp {
            /* 24px */
            position: relative;
            width: 336px;
            height: 504px;
            margin: auto;
        }

        /* ËÉåÊôØÁΩëÊ†ºÁ∫ø */
        .bg {
            height: inherit;
            display: flex;
            flex-direction: column;
            border-top: 1px solid #333;
            border-left: 1px solid #333;
        }

        .bg>li {
            display: flex;
            flex: 1;
        }

        .bg>li>div {
            flex: 1;
            border-bottom: 1px solid #333;
            border-right: 1px solid #333;
            background-color: #c3ff8b;
        }

        /* ÊÇ¨ÊµÆÊñπÂùó */
        .pie {
            position: absolute;
            top: 0;
            left: 0;
            width: 48px;
            height: 48px;
            line-height: 40px;
            font-size: 28px;
            background-color: #f5ffcd;
            text-align: center;
            cursor: pointer;
            box-sizing: border-box;
            border: 1px solid #222;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: inset 0 -4px 0px #6ea012, inset 0 -6px 0px #bad176;
            transition-property: transform, opacity;
            transition-duration: 0.4s, 0.25s;
        }

        .pie.hover {
            transition: transform 0.15s;
        }

        .pie.cover {
            /* Á¶ÅÊ≠¢Èº†Ê†á‰ªª‰ΩïË°å‰∏∫ */
            pointer-events: none;
        }

        .pie::after {
            content: "";
            display: block;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            background-color: rgba(0, 0, 0, 0);
            transition: all 0.3s;
        }

        .pie.cover::after {
            content: "";
            background-color: rgba(0, 0, 0, 0.4);
        }

        .pie.pending {
            pointer-events: none;
            /* transition: transform .15s; */
            z-index: 1;
        }

        /* ÈòüÂàóÂå∫ */
        .queue {
            height: 48px;
            width: 336px;
            border: 2px solid #503307;
            padding: 4px;
            border-radius: 8px;
            background-color: #c38032;
        }

        .queue_content {
            border-radius: inherit;
            width: 100%;
            height: 100%;
            background-color: #965a1c;
            box-shadow: inset 0 6px 0 #7f4e16;
        }

        /* ÈÅìÂÖ∑Âå∫ */
        .prop {
            margin: 16px auto 0px auto;
            display: flex;
            justify-content: space-evenly;
            align-items: center;
        }

        .prop_item {
            position: relative;
            width: 76px;
            height: 56px;
            border: 2px solid #333;
            display: flex;
            border-radius: 6px;
            background-color: #27a2f6;
            box-shadow: 0px 4px 0 rgba(0, 0, 0, 0.3), inset 0px 4px 0px #6dcdfd;
            cursor: pointer;
            text-align: center;
            font-size: 20px;
        }

        .prop_item_i {
            line-height: 50px;
            color: #fff;
            width: inherit;
            height: 50px;
            border-bottom: inherit;
            border-radius: inherit;
        }

        .prop_item.cover {
            pointer-events: none;
        }

        .prop_item.cover::after {
            content: "";
            display: block;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            position: absolute;
            background-color: rgba(0, 0, 0, 0.6);
            cursor: default;
        }

        .tools_count {
            background-color: #000;
            display: block;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            text-align: center;
            position: absolute;
            top: -8px;
            right: -8px;
            font-weight: bold;
            font-size: 14px;
            line-height: 22px;
            box-shadow: 0px 3px 0px rgba(0, 0, 0, 0.3);
        }

        /* ÈÅÆÁΩ© */
        .shadow {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2;
        }

        .shadow_main {
            width: 300px;
            height: 260px;
            position: absolute;
            left: 50%;
            top: 50%;
            background-color: #f5ffcd;
            transform: translate(-50%, -50%);
            border-radius: 20px;
            font-weight: bold;
            text-align: center;
        }

        .shadow_main .title {
            font-size: 46px;
            line-height: 80px;
            color: #333;
        }

        .shadow_main .levelTitle {
            color: #27a2f6;
            font-size: 22px;
        }

        .shadow_main .block {
            font-weight: bold;
            color: #777;
            margin-bottom: 5px;
        }

        .shadow_main .button {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translate(-50%);
            border: 1px solid #000;
            width: 120px;
            height: 40px;
            font-size: 18px;
            line-height: 40px;
            border-radius: 8px;
            cursor: pointer;
            background-color: rgb(255, 240, 101);
            color: #333;
        }

        .shadow_main .button:hover {
            background-color: rgb(189, 178, 78);
        }

        .shadow_main .set {
            cursor: pointer;
            color: #333;
        }

        .shadow_main .set:hover {
            text-decoration: underline;
        }

        /* ÈÄâÊã©ËèúÂçï */
        .menu {
            position: absolute;
            background-color: #c3ff8b;
            display: block;
            width: 100%;
            height: 100%;
            left: 0;
            top: 0;
        }

        .menu_i {
            width: 200px;
            height: 200px;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background-color: #f5ffcd;
            border: 4px solid #545549;
            z-index: 2;
            border-radius: 20px;
            text-align: center;
            overflow: hidden;
        }

        .menu_i .title {
            line-height: 44px;
            font-size: 24px;
            color: #616159;
            margin-bottom: 16px;
        }

        .menu_i li {
            border-bottom: 1px solid #666;

            color: #555;
            transition: all 0.2s;
        }

        /* ÂØπÁ¨¨‰∏Ä‰∏™ÁâπÊÆäÂ§ÑÁêÜ */
        .tab1 li:nth-of-type(1) {
            border-top: 1px solid #666;
        }

        .tab1 li {
            font-weight: bold;
            cursor: pointer;
            line-height: 40px;
            font-size: 18px;
        }

        .tab1 li:hover {
            background-color: rgb(180, 181, 127);
            color: #fff;
        }

        /* tab2 */
        .tab2 li,
        .tab3 li {
            height: 40px;
            line-height: 40px;
            flex: 1;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
        }

        .tab2 input {
            width: 110px;
        }

        .menu_i .buttonWarp div {
            height: 36px;
            line-height: 36px;
            text-align: center;
            font-weight: bold;
            color: #616159;
            cursor: pointer;
            transition: all 0.15s;
        }

        .menu_i .buttonWarp div:hover {
            background-color: rgb(180, 181, 127);
            color: #fff;
        }

        .tab2 .buttonWarp div {
            width: 100px;
            float: left;
        }

        .tab2 .buttonWarp div:nth-of-type(1) {
            border-right: 1px solid #666;
            width: 98px;
        }

        .tab3 input {
            width: 80px;
        }

        /* Êí§ÈîÄÊèêÁ§∫ */
        .revokeTips {
            position: absolute;
            top: 50%;
            left: 50%;
            color: #fff;
            transform: translate(-50%, -50%);
            background-color: #555;
            width: 120px;
            text-align: center;
            line-height: 34px;
            height: 34px;
            border-radius: 6px;
            border: 2px solid #222;
        }
    </style>
</head>

<body>
    <div class="" id="app">
        <div class="main">
            <!-- ‰∏ª‰Ωì -->
            <div class="warp">
                <!-- ËÉåÊôØ -->
                <!-- <ul class="bg">
                    <li v-for="item in bg">
                        <div v-for="i in item"></div>
                    </li>
                </ul> -->
                <!-- ÊÇ¨ÊµÆÊñπÂùóÂå∫Âüü -->
                <!-- <ul class="scene" @click="clickPie($event)"> -->
                <ul class="scene" @touchstart="touchStart($event)" @touchmove="touchMove($event)"
                    @touchend="touchEnd($event)">
                    <li v-for="(item,index) in cardList">
                        <div v-for="i in item"
                            :class="['pie',{cover:i.isCover},{hover:i.isHover},{pending:i.isPending}]"
                            :style="computedStyle(i)" :x="i.x" :y="i.y" :z="index" :key="i.cardId" :cardid="i.cardId">
                            {{i.icon}}
                        </div>
                    </li>
                </ul>
            </div>
            <!-- ÂàóÈòüÂå∫  queue-->
            <div class="queue">
                <div class="queue_content"></div>
            </div>
            <!-- ÈÅìÂÖ∑Âå∫  prop-->
            <div class="prop">
                <div class="prop_item" :class="{'cover':tools.remove==0 }" @click="remove">
                    <div class="prop_item_i">
                        <span class="icon">ÁßªÂá∫</span>
                        <span class="tools_count" v-show="tools.remove">{{tools.remove}}</span>
                    </div>
                </div>
                <div class="prop_item" :class="{'cover':tools.revoke==0 }" @click="revoke">
                    <div class="prop_item_i">
                        <span class="icon">Êí§ÈîÄ</span>
                        <span class="tools_count" v-show="tools.revoke">{{tools.revoke}}</span>
                    </div>
                </div>
                <div class="prop_item" :class="{'cover':tools.shuffle==0 }" @click="shuffle">
                    <div class="prop_item_i">
                        <span class="icon">Ê¥óÁâå</span>
                        <span class="tools_count" v-show="tools.shuffle">{{tools.shuffle}}</span>
                    </div>
                </div>
            </div>
            <!-- ÈÅÆÁΩ© -->
            <div class="shadow" v-show="gameStatus">
                <!-- ËèúÂçïdialog -->
                <div class="shadow_main">
                    <!-- Ê†áÈ¢ò -->
                    <p class="title" v-if="gameStatus == 'success'">ÂÖ≥Âç°ÈÄöËøá</p>
                    <p class="title" v-else-if="gameStatus == 'fail'">Ê∏∏ÊàèÂ§±Ë¥•</p>
                    <p class="title" v-else-if="gameStatus == 'next'">ÈÄöÂÖ≥ÊàêÂäü</p>
                    <!-- ÂÖ≥Âç°Á≠âÁ∫ß -->
                    <p class="levelTitle" v-if="gameStatus == 'next'">
                        ÂÖ≥Âç°Ôºö{{curLevel}}
                    </p>
                    <!-- ÊñπÂùóÊï∞Èáè -->
                    <p class="block" v-if="gameStatus == 'fail'">
                        Ââ©‰ΩôÊñπÂùóÔºö{{curPieTotal}}
                    </p>
                    <p class="block" v-else>Ê∂àÈô§ÊñπÂùóÔºö{{pieTotal}}</p>
                    <!-- ÈÄâÈ°π -->
                    <span class="set" v-if="gameStatus != 'next'"
                        @click="menu.showMenu='true';gameStatus='';cardList=[]">‚öôÈÄâÈ°π</span>
                    <!-- ÊåâÈíÆ -->
                    <div class="button" v-if="gameStatus == 'success'" @click="play(menu.mode)">
                        ÈáçÊñ∞Ê∏∏Áé©
                    </div>
                    <div class="button" v-else-if="gameStatus == 'fail'" @click="play(menu.mode)">
                        ÂÜçÊ¨°Â∞ùËØï
                    </div>
                    <div class="button" v-else-if="gameStatus == 'next'" @click="play(menu.mode)">
                        ‰∏ã‰∏ÄÂÖ≥Âç°
                    </div>
                </div>
            </div>
            <!-- ÈÄâÈ°π -->
            <div class="menu" v-show="menu.showMenu">
                <div class="menu_i">
                    <div class="tab1" v-if="menu.tab == 0">
                        <p class="title">ÈÄâÈ°πËÆæÁΩÆ</p>
                        <ul>
                            <li @click="play(1)">Ê®°Êãü</li>
                            <li @click="play(2)">ÂÖ≥Âç°</li>
                            <li @click="menu.tab=1">Ëá™ÂÆö‰πâ</li>
                        </ul>
                    </div>
                    <!-- Ëá™ÂÆö‰πâÈù¢Êùø -->
                    <div class="tab2" v-else-if="menu.tab == 1">
                        <ul>
                            <li>
                                <span> Â±ÇÊï∞:{{menu.custom.numZ}}</span>
                                <input type="range" v-model="menu.custom.numZ" name="" id="" min="1" max="14" />
                            </li>
                            <li>
                                <span> ÂõæÊ°à:{{menu.custom.iconCount}} </span>

                                <input type="range" v-model="menu.custom.iconCount" name="" id="" min="1" max="18" />
                            </li>
                            <li>
                                <span> ÂØÜÂ∫¶:{{menu.custom.density}} </span>
                                <input type="range" v-model="menu.custom.density" name="" id="" step="0.01" min="0.1"
                                    max="1" />
                            </li>
                            <li>
                                <span> Âå∫Èó¥:</span>
                                <input @click="menu.tab = 2" type="button" value="ÈÄâÊã©Âå∫Èó¥ËåÉÂõ¥" />
                            </li>
                        </ul>
                        <div class="buttonWarp">
                            <div class="buttonL" @click="menu.tab=0;menu.mode=0">ËøîÂõû</div>
                            <div class="buttonR" @click="play(3)">Á°ÆËÆ§</div>
                        </div>
                    </div>
                    <div class="tab3" v-else-if="menu.tab == 2">
                        <ul>
                            <li>
                                <span> Ê®™ÂêëËµ∑ÁÇπ:{{menu.custom.range.x[0]}}</span>
                                <input v-model="menu.custom.range.x[0]" type="range" name="" id="" min="0" max="8" />
                            </li>
                            <li>
                                <span> Ê®™ÂêëÁªàÁÇπ:{{menu.custom.range.x[1]}} </span>
                                <input v-model="menu.custom.range.x[1]" type="range" name="" id="" min="6" max="14" />
                            </li>
                            <li>
                                <span> Á∫µÂêëËµ∑ÁÇπ:{{menu.custom.range.y[0]}} </span>
                                <input v-model="menu.custom.range.y[0]" type="range" name="" id="" step="1" min="0"
                                    max="12" />
                            </li>
                            <li>
                                <span> Á∫µÂêëÁªàÁÇπ:{{menu.custom.range.y[1]}} </span>
                                <input v-model="menu.custom.range.y[1]" type="range" name="" id="" step="1" min="6"
                                    max="18" />
                            </li>
                        </ul>
                        <div class="buttonWarp">
                            <div @click="menu.tab=1">Á°ÆËÆ§</div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Êí§ÈîÄÊèêÁ§∫ -->
            <div class="revokeTips" v-show="showRevokeTips">Êí§ÈîÄÂÜÖÂÆπ‰∏∫Á©∫</div>
        </div>
    </div>
    <script>
        console.clear();
        // Âà§Êñ≠ÁßªÂä®ËÆæÂ§á

        function isMobileDevice() {
            // ÂåπÈÖçÂ∏∏ËßÅÁöÑÁßªÂä®ËÆæÂ§áÁöÑÁî®Êà∑‰ª£ÁêÜ
            const mobileUserAgentRegex = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;
            // Ëé∑ÂèñÁî®Êà∑‰ª£ÁêÜÂ≠óÁ¨¶‰∏≤
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            // ‰ΩøÁî®Ê≠£ÂàôË°®ËææÂºèÂåπÈÖçÁî®Êà∑‰ª£ÁêÜÂ≠óÁ¨¶‰∏≤


            const str = mobileUserAgentRegex.test(userAgent);

            // ‰ΩøÁî®Á§∫‰æã
            if (!str) {
                alert('ËØ∑Âú®ÁßªÂä®Á´ØËøêË°å');
            }
        }
        isMobileDevice();

        //ÂÜÖÂÆπÊ†∑Âºè
        const contentType = {
            1: "ü•ï",
            2: "‚úÇÔ∏è",
            3: "ü•¶",
            4: "ü•õ",
            5: "üåä",
            6: "üß§",
            7: "üßµ",
            8: "üå±",
            9: "üî®",
            10: "üåΩ",
            11: "üåæ",
            12: "üêë",
            13: "üî•",
            14: "‚òòÔ∏è",
            15: "‚≠êÔ∏è",
            16: "ü•ù",
            17: "üçâ",
            18: "üöÄ",
        };

        const app = new Vue({
            el: "#app",
            data: {
                // #region
                bg: [],
                curLevel: 1,
                // ÊâÄÊúâÂç°ÁâåÊï∞ÁªÑ
                cardList: [],
                // ÂàóÈòüÂå∫
                pendingList: [],
                // Âç°ÁâáÊÄªÊï∞
                pieTotal: 0,
                curPieTotal: 0,
                // ÈÅìÂÖ∑Ê¨°Êï∞
                tools: {
                    remove: 1,
                    revoke: 2,
                    shuffle: 3,
                },
                // Èò¥ÂΩ±ÊñπÂùó
                coverList: [],
                // Áî®‰∫éÊí§ÈîÄÁöÑÊï∞ÁªÑ
                revokeList: [],
                showRevokeTips: false,
                //  fail success next
                gameStatus: "",
                // #endregion
                // ÈÄâÈ°πÂÖ≥ËÅîÊï∞ÊçÆ
                menu: {
                    showMenu: true,
                    mode: 0,
                    tab: 0,
                    custom: {
                        numZ: 4,
                        iconCount: 4,
                        density: 0.2,
                        range: {
                            x: [2, 12],
                            y: [4, 14],
                        },
                    },
                },
                // Á¶ÅÊ≠¢ÁÇπÂáª
                ing: false,
                // Áî®‰∫éÁßªÂä®Á´ØÁÇπÂáª
                touch: {
                    id: null,
                    pie: null,
                    start: null,
                    move: null,
                },
            },
            mounted() {
                //ÂàùÂßãÂåñËÉåÊôØ
                this.bg = this.initBg();
                // this.createPie();
            },
            methods: {
                computedStyle(i) {
                    let scale = 1;
                    if (i.isOut) scale = 0;
                    if (i.isHover) scale = 1.3;
                    return {
                        transform: `translate(${i.offsetX},${i.offsetY}) scale(${scale}) translateZ(0) translate3d(0,0,0)`,
                        zIndex: i.isHover ? 1 : "",
                        opacity: i.isOpacity ? 0 : "",
                    };
                },
                touchStart(e) {
                    if (this.ing || e.target.nodeName !== "DIV") {
                        return;
                    }
                    this.ing = true;
                    // ‰ΩøÁî®‰∫Ü‰∫ã‰ª∂‰ª£ÁêÜÔºåÊâÄ‰ª•ÈúÄË¶ÅËØªÂèñÂ±ûÊÄß‰ª•Á°ÆÂÆöÂÖÉÁ¥†
                    const x = e.target.getAttribute("x");
                    const y = e.target.getAttribute("y");
                    const z = e.target.getAttribute("z");
                    const id = e.target.getAttribute("cardid");
                    const temp = this.coverList;
                    const pie = temp[temp.length - 1 - z][y][x];

                    pie.isHover = true;
                    this.touch.pie = pie;
                    this.touch.id = id;
                    this.touch.start = [
                        e.target.getBoundingClientRect().left,
                        e.target.getBoundingClientRect().top,
                    ];
                },
                touchMove(e) {
                    this.touch.move = [e.touches[0].clientX, e.touches[0].clientY];
                },
                touchEnd(e) {
                    // Á¶ÅÊ≠¢Â§öÊåáÊìç‰Ωú
                    if (this.touch.id !== e.target.getAttribute("cardid")) {
                        return;
                    }
                    this.ing = false;
                    // Ê≤°ÊúâÁßªÂä® Áõ¥Êé•Ê∑ªÂä†
                    if (this.touch.move == null) {
                        this.addPending(this.touch.pie);
                        this.checkCover(this.touch.pie);
                    } else {
                        // ÁßªÂä®Âà§Êñ≠ÊòØÂê¶Âá∫Áïå
                        const x = this.touch.start[0];
                        const y = this.touch.start[1];
                        const moveX = this.touch.move[0];
                        const moveY = this.touch.move[1];
                        // ÂÖÉÁ¥† 48px Â§ßÂ∞è
                        const boolX = moveX > x && moveX < x + 48;
                        const boolY = moveY > y && moveY < y + 48;

                        if (boolX && boolY) {
                            // console.log("ËåÉÂõ¥Èáå");
                            this.addPending(this.touch.pie);
                            this.checkCover(this.touch.pie);
                        }
                    }
                    this.touch.pie.isHover = false;
                    this.touch = {
                        pie: null,
                        start: null,
                        move: null,
                    };
                },
                initBg() {
                    const arr = [];
                    const x = 21;
                    const y = 14;
                    for (let i = 0; i < x; i++) {
                        arr.push([]);
                        for (let j = 0; j < y; j++) {
                            arr[i].push(0);
                        }
                    }
                    return arr;
                },
                // ÂàùÂßãÂåñÊï∞ÊçÆ
                init(mode) {
                    this.pieTotal = 0;
                    this.curPieTotal = 0;
                    this.pendingList = [];
                    this.coverList = [];
                    this.cardList = [];
                    this.gameStatus = "";
                    this.ing = false;
                },
                // ËèúÂçïÈÄâÊã©
                play(mode) {
                    // console.log("play");
                    this.menu.mode = mode;
                    if (this.gameStatus == "next") {
                        this.curLevel++;
                    } else {
                        this.curLevel = 1;
                        this.tools = {
                            remove: 1,
                            revoke: 2,
                            shuffle: 3,
                        };
                        this.revokeList = [];
                    }
                    // ÁîüÊàêÊñπÂùó
                    this.createPie(mode);
                    this.menu.showMenu = false;
                },
                // ÈöèÊú∫ÁîüÊàêÊñπÂùó mode: 0 1 2 3
                createPie(mode = 0) {
                    // ÂàùÂßãÂåñ
                    this.init(mode);
                    // ÂùóÂü∫Êú¨‰ø°ÊÅØ
                    function Pie(x, y, offsetX, offsetY) {
                        this.x = x;
                        this.y = y;
                        this.offsetX = offsetX;
                        this.offsetY = offsetY;
                        this.realOffsetX = offsetX;
                        this.realOffsetY = offsetY;
                        this.isOut = false;
                        this.isPending = false;
                        this.isRemove = false;
                        this.isCover = false;
                        this.isHover = false;
                        this.isOpacity = false;
                        this.icon = "";
                        this.cardId = Math.floor(Math.random() * 1000000);
                    }

                    // Ê∏≤ÊüìÊï∞ÁªÑ
                    const arr = [];
                    // Â±ÇÊï∞
                    let numZ = 2;
                    // ÂõæÊ°àÊï∞Èáè
                    let iconCount = 2;
                    // Êï∞ÊçÆÂ∏ÉÂ±ÄÊï∞ÁªÑ
                    const tempArrX = 14;
                    const tempArrY = 20;
                    // ËßÑÂàô
                    let rule = [
                        {
                            curZ: 14,
                            range: {
                                x: [0, 14],
                                y: [0, 18],
                            },
                            density: 0.3,
                        },
                    ];

                    // Âà§Êñ≠ÂàõÂª∫Ê®°Âºè
                    switch (mode) {
                        case 1:
                            // Ê®°ÊãüÊ®°Âºè
                            numZ = 12;
                            iconCount = 18;
                            rule = [
                                {
                                    curZ: 1,
                                    // range: [0, 14],
                                    range: {
                                        x: [1, 13],
                                        y: [1, 13],
                                    },
                                    density: 0.25,
                                    must: [
                                        [1, 1],
                                        [11, 1],
                                        [11, 11],
                                        [1, 11],

                                        [3, 3],
                                        [9, 3],
                                        [3, 9],
                                        [9, 9],
                                        [5, 7],
                                        [7, 5],

                                        [1, 16],
                                        [5, 16],
                                        [7, 16],
                                        [11, 16],
                                    ],
                                },
                                {
                                    curZ: 2,
                                    range: {
                                        x: [2, 12],
                                        y: [2, 12],
                                    },
                                    density: 1,
                                    must: [
                                        [0, 0],
                                        [2, 0],
                                        [2, 2],
                                        [0, 2],
                                        [12, 0],
                                        [10, 0],
                                        [10, 2],
                                        [12, 2],
                                        [12, 12],
                                        [12, 10],
                                        [10, 12],
                                        [10, 10],
                                        [0, 10],
                                        [0, 12],
                                        [2, 10],
                                        [2, 12],

                                        [0, 16],
                                        [2, 16],
                                        [4, 16],
                                        [6, 16],
                                        [8, 16],
                                        [10, 16],
                                        [12, 16],
                                    ],
                                },
                                {
                                    curZ: 3,
                                    range: {
                                        x: [5, 8],
                                        y: [5, 8],
                                    },
                                    density: 0,
                                    must: [
                                        [1, 1],
                                        [11, 1],
                                        [11, 11],
                                        [1, 11],

                                        [3, 3],
                                        [3, 6],
                                        [3, 9],
                                        [6, 3],
                                        [9, 3],

                                        [9, 6],
                                        [9, 9],
                                        [6, 9],

                                        [6, 6],
                                    ],
                                },
                                {
                                    curZ: 5,
                                    range: {
                                        x: [2, 12],
                                        y: [2, 12],
                                    },
                                    density: 0.4,
                                    must: [
                                        [5, 5],
                                        [7, 5],
                                        [5, 7],
                                        [7, 7],

                                        [2, 2],
                                        [2, 10],
                                        [10, 2],
                                        [10, 10],
                                    ],
                                },
                                {
                                    curZ: 8,
                                    range: {
                                        x: [3, 11],
                                        y: [3, 11],
                                    },
                                    density: 0.4,
                                    must: [[6, 6]],
                                },
                                {
                                    curZ: 12,
                                    range: {
                                        x: [4, 10],
                                        y: [4, 10],
                                    },
                                    density: 0.55,
                                    empty: [[6, 6]],
                                },
                            ];
                            break;
                        case 2:
                            // ÂÖ≥Âç°Ê®°Âºè
                            numZ = Math.min(this.curLevel + 1, 12);
                            iconCount = Math.min(this.curLevel + 1, 18);
                            rule = [
                                {
                                    curZ: 12,
                                    range: {
                                        x: [0, 14],
                                        y: [0, 18],
                                    },
                                    density: 0.25,
                                },
                            ];
                            break;
                        case 3:
                            // Ëá™ÂÆö‰πâÊ®°Âºè
                            numZ = this.menu.custom.numZ;
                            iconCount = this.menu.custom.iconCount;
                            rule = [
                                {
                                    curZ: 14,
                                    range: {
                                        // ËΩ¨Êç¢‰∏∫numberÁ±ªÂûã
                                        x: [
                                            this.menu.custom.range.x[0] - 0,
                                            this.menu.custom.range.x[1] - 0,
                                        ],
                                        y: [
                                            this.menu.custom.range.y[0] - 0,
                                            this.menu.custom.range.y[1] - 0,
                                        ],
                                    },
                                    density: this.menu.custom.density,
                                },
                            ];
                            break;
                    }
                    // iconÊ∏≤ÊüìÊï∞Èáè
                    let tempRule;
                    // Áî®‰∫éÂåπÈÖçrule
                    let countZ = 0;
                    // Â°´ÂÖÖÊï∞ÁªÑ Â±ÇÊï∞ Z
                    for (let z = 0; z < numZ; z++) {
                        // ÂêÑÂ±ÇËßÑÂàô
                        tempRule = rule[countZ];
                        if (z < rule[countZ].curZ) {
                            tempRule = rule[countZ];
                        } else {
                            countZ++;
                            if (z < rule[countZ].curZ) {
                                tempRule = rule[countZ];
                            }
                        }
                        // Âç°ÁâáÊÄªÊï∞ÁªÑ
                        arr.push([]);
                        // Êï∞ÂÄºÂ∏ÉÂ±Ä
                        const tempCoverList = [];
                        // ÊØèÂ±ÇÂàùÂßãÊï∞ÂÄºÂ∏ÉÂ±Ä
                        for (let i = 0; i < tempArrY; i++) {
                            // ÂàõÂª∫ÊØèË°åÁöÑÁ©∫Êï∞ÁªÑ
                            tempCoverList[i] = [];
                            for (let j = 0; j < tempArrX; j++) {
                                tempCoverList[i][j] = 0;
                            }
                        }
                        // ÂøÖÂ°´Âå∫Âüü
                        if (tempRule.must) {
                            tempRule.must.forEach((item) => {
                                const x = item[1];
                                const y = item[0];

                                const offsetX = y * 24 + "px";
                                const offsetY = x * 24 + "px";

                                const pie = new Pie(y, x, offsetX, offsetY);
                                arr[z].push(pie);
                                // coverList
                                tempCoverList[x][y] = pie;
                                tempCoverList[x + 1][y] = pie;
                                tempCoverList[x][y + 1] = pie;
                                tempCoverList[x + 1][y + 1] = pie;

                                this.pieTotal++;
                            });
                        }
                        // Ë°å
                        for (
                            let i = tempRule.range.y[0];
                            i < tempRule.range.y[1] - 1;
                            i++
                        ) {
                            // Âàó
                            for (
                                let j = tempRule.range.x[0];
                                j < tempRule.range.x[1] - 1;
                                j++
                            ) {
                                // Â∑≤Â≠òÂú®Ë∑≥Ëøá
                                if (
                                    tempCoverList[i][j] ||
                                    tempCoverList[i][j + 1] ||
                                    tempCoverList[i + 1][j + 1] ||
                                    tempCoverList[i + 1][j]
                                ) {
                                    continue;
                                }
                                // ÁïôÁ©∫Âå∫Âüü
                                if (tempRule.empty) {
                                    const bool = tempRule.empty.some((item) => {
                                        return (
                                            (i == item[1] ||
                                                i == item[1] + 1 ||
                                                i == item[1] - 1) &&
                                            (j == item[0] || j == item[0] + 1 || j == item[0] - 1)
                                        );
                                    });
                                    if (bool) {
                                        continue;
                                    }
                                }
                                // Â°´ÂÖÖ‰ø°ÊÅØ
                                if (Math.random() < tempRule.density) {
                                    const x = j;
                                    const y = i;
                                    const offsetX = j * 24 + "px";
                                    const offsetY = i * 24 + "px";
                                    const pie = new Pie(x, y, offsetX, offsetY);

                                    // ‰øùÂ≠òÊï∞ÁªÑ
                                    arr[z].push(pie);
                                    // Âõõ‰∏™ÊñπÂùóÂ°´ÂÖÖ
                                    tempCoverList[i][j] = pie;
                                    tempCoverList[i + 1][j] = pie;
                                    tempCoverList[i][j + 1] = pie;
                                    tempCoverList[i + 1][j + 1] = pie;

                                    this.pieTotal++;
                                }
                            }
                        }
                        this.coverList.push(tempCoverList);
                    }

                    // ÈíàÂØπÁâπÊÆäÊñπÂùóÂ§ÑÁêÜ
                    if (mode == 1) {
                        for (let i = 0; i < 11; i++) {
                            let x = 0;
                            let y = 14;
                            let offsetX;
                            let offsetY = "336px";
                            const tempCoverList = this.coverList[11 - i];

                            offsetX = i * 6 + "px";
                            let pie = new Pie(x, y, offsetX, offsetY);

                            arr[arr.length - 1 - i].push(pie);

                            tempCoverList[y][x] = pie;
                            tempCoverList[y + 1][x] = pie;
                            tempCoverList[y][x + 1] = pie;
                            tempCoverList[y + 1][x + 1] = pie;
                            // Âè≥‰æß
                            x = 12;
                            offsetX = 288 - i * 6 + "px";

                            pie = new Pie(x, y, offsetX, offsetY);
                            arr[arr.length - 1 - i].push(pie);
                            tempCoverList[y][x] = pie;
                            tempCoverList[y + 1][x] = pie;
                            tempCoverList[y][x + 1] = pie;
                            tempCoverList[y + 1][x + 1] = pie;
                        }
                    }

                    // Êï∞ÁªÑÂÄíÂ∫èÔºåÁ¨¶ÂêàÊ∏≤ÊüìËßÑÂàô
                    arr.reverse();
                    // Êï∞Èáè‰∏çË∂≥
                    if (this.pieTotal < 3) {
                        this.createPie(mode);
                        return;
                    }
                    // Âèñ3ÁöÑÂÄçÊï∞Ôºå‰ªéÂ∫ïÈÉ®ÂºπÂá∫
                    if (this.pieTotal % 3) {
                        // if (false) {
                        const r = this.pieTotal % 3;
                        const cover = this.coverList;
                        for (let i = 0; i < r; i++) {
                            const a = arr[0].shift();
                            this.pieTotal--;

                            cover[cover.length - 1][a.y][a.x] = 0;
                            cover[cover.length - 1][a.y + 1][a.x] = 0;
                            cover[cover.length - 1][a.y][a.x + 1] = 0;
                            cover[cover.length - 1][a.y + 1][a.x + 1] = 0;
                        }
                    }
                    // Â°´ÂÖÖÂõæÊ°à  ÂÖÉÁ¥†Âú®Êï∞ÁªÑ‰∏≠ÁöÑ‰ΩçÁΩÆ
                    const iconArrIndex = [];
                    arr.forEach((element, index) => {
                        element.forEach((item, index_i) => {
                            iconArrIndex.push([index, index_i]);
                        });
                    });
                    // Êâì‰π±Êï∞ÁªÑ‰ΩçÁΩÆÔºåÈöèÊú∫‰ΩçÁΩÆÊ∑ªÂä†icon
                    this.shuffleArray(iconArrIndex);
                    // icon Âæ™ÁéØËµãÂÄº
                    let a = 0;
                    one: while (true) {
                        // icon Âæ™ÁéØÊ∏≤Êüì
                        for (let i = 1; i <= iconCount; i++) {
                            // ËøûÁª≠ËµãÂÄº‰∏â‰∏™
                            for (let j = 0; j < 3; j++) {
                                const temp = iconArrIndex[a];
                                arr[temp[0]][temp[1]].icon = contentType[i];
                                // end
                                if (a == iconArrIndex.length - 1) {
                                    break one;
                                }
                                a++;
                            }
                        }
                    }
                    // Âä®Áîª
                    arr.forEach((element) => {
                        element.forEach((item) => {
                            item.offsetX = "144px";
                            item.offsetY = "216px";
                        });
                    });
                    this.ing = true;
                    setTimeout(() => {
                        arr.forEach((element) => {
                            element.forEach((item) => {
                                item.offsetX = item.realOffsetX;
                                item.offsetY = item.realOffsetY;
                            });
                        });
                        setTimeout(() => {
                            this.ing = false;
                        }, 400);
                    }, 400);
                    // ËµãÂÄº
                    this.curPieTotal = this.pieTotal;
                    this.cardList = arr;
                    this.checkCover();
                },
                // ÁÇπÂáª‰∫§‰∫í
                clickPie(e) {
                    if (this.ing || e.target.nodeName !== "DIV") {
                        return;
                    }
                    const x = e.target.getAttribute("x");
                    const y = e.target.getAttribute("y");
                    const z = e.target.getAttribute("z");
                    const temp = this.coverList;
                    const pie = temp[temp.length - 1 - z][y][x];

                    this.addPending(pie);
                    this.checkCover(pie);
                },
                // Ê∑ªÂä†Ëá≥ÈòüÂàóÂå∫
                addPending(e) {
                    // console.log("Ê∑ªÂä†ÂàóÈòü");
                    // Ê£ÄÊü•Êù°‰ª∂
                    e.offsetY = "510px";
                    // ÊâæÂà∞ÊúÄÂêé‰∏Ä‰∏™Áõ∏ÂêåÂÖÉÁ¥†
                    let index = -1;
                    for (let i = 0; i < this.pendingList.length - 1; i++) {
                        if (e.icon == this.pendingList[i].icon) {
                            index = i;
                        }
                    }
                    if (index !== -1) {
                        // ÊîπÂèòpendingListÂÖÉÁ¥†‰ΩçÁΩÆ
                        const list1 = this.pendingList.slice(0, index + 1);
                        const list2 = this.pendingList.slice(
                            index + 1,
                            this.pendingList.length
                        );
                        // ÊãºÊé•Êñ∞Êï∞ÁªÑ
                        this.pendingList = [...list1, e, ...list2];
                    } else {
                        this.pendingList.push(e);
                    }
                    // ÊâßË°åÂä®Áîª
                    this.pendingAnimation();
                    e.isPending = true;
                    // Êí§ÈîÄÊï∞ÁªÑÊ∑ªÂä†
                    this.revokeList.push(e);
                    // Ê£ÄÊü•Ê∂àÈô§
                    this.check(e);
                },
                // pendingListÊéíÂ∫èÂä®Áîª
                pendingAnimation() {
                    this.pendingList.forEach((item, index) => {
                        item.offsetX = index * 48 + "px";
                    });
                },
                // Ê£ÄÊü•ÈÅÆÁΩ©
                checkCover(pie) {
                    // console.log("Ê£ÄÊü•ÈÅÆÁΩ©");
                    // ÁÇπÂáª
                    if (pie) {
                        const startX = pie.x <= 0 ? 0 : pie.x - 1;
                        const endX = pie.x >= 14 ? 14 : pie.x + 1;
                        const startY = pie.y <= 0 ? 0 : pie.y - 1;
                        const endY = pie.y >= 18 ? 18 : pie.y + 1;

                        const coverArray = this.coverList;
                        // Âæ™ÁéØÁÇπÂáªÊñπÂùóÂë®Âõ¥‰πùÂÆ´Ê†º
                        for (let z = coverArray.length - 1; z >= 0; z--) {
                            for (let y = startY; y <= endY; y++) {
                                for (let x = startX; x <= endX; x++) {
                                    // Á°Æ‰øùÊúâÊïàÊï∞ÊçÆ
                                    const item = coverArray[z][y][x];
                                    if (item) {
                                        if (item.isPending || item.isOut) {
                                            continue;
                                        } else {
                                            // ÂÖàËÆ©ÊâÄÊúâÂÖÉÁ¥†ÊòæÁ§∫ÂÜçÂà§Êñ≠ÈöêËóè
                                            item.isCover = false;
                                            // console.log(item.icon, [item.x, item.y, z] + '-----------');
                                            // Ê£ÄÊü•‰∏äÂ±Ç
                                            for (let countZ = z - 1; countZ >= 0; countZ--) {
                                                // ‰∏Ä‰∏™ÊñπÂùóÂõõ‰∏™Ê†ºÂ≠ê
                                                let a, b, c, d;
                                                a = coverArray[countZ][item.y][item.x];
                                                b = coverArray[countZ][item.y + 1][item.x];
                                                c = coverArray[countZ][item.y][item.x + 1];
                                                d = coverArray[countZ][item.y + 1][item.x + 1];
                                                // ‰ª•‰∏ãÊÉÖÂÜµÈÉΩ‰∏çÁÆóÈÅÆÊå°
                                                if (!a || a.isPending || a.isOut || a.isRemove) a = 0;
                                                if (!b || b.isPending || b.isOut || b.isRemove) b = 0;
                                                if (!c || c.isPending || c.isOut || c.isRemove) c = 0;
                                                if (!d || d.isPending || d.isOut || d.isRemove) d = 0;

                                                if (a || b || c || d) {
                                                    item.isCover = true;
                                                    // console.log("ÊúâË¶ÜÁõñ");
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                    // ÂàùÂßãÂåñ
                    else {
                        const coverArray = this.coverList;
                        // Â±Ç
                        for (let z = coverArray.length - 1; z >= 0; z--) {
                            // Ë°å
                            for (let x = 0; x < coverArray[z].length; x++) {
                                // Âàó
                                for (let y = 0; y < coverArray[z][x].length; y++) {
                                    // ÊúâÊïàÊï∞ÊçÆ
                                    if (coverArray[z][x][y]) {
                                        // ‰∏é‰∏äÂ±ÇÊØîËæÉ
                                        for (let arrZ = z - 1; arrZ >= 0; arrZ--) {
                                            if (coverArray[arrZ][x][y]) {
                                                coverArray[z][x][y].isCover = true;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                // Ê£ÄÊü•Ê∂àÈô§ÊàñÊ∏∏ÊàèËÉúÂà©
                check(e) {
                    // console.log("Ê£ÄÊü•");
                    const tempList = this.pendingList;
                    let frist = -1;
                    let last = 0;
                    // ‰øùÂ≠òÁõ∏ÂêåÂùóÔºåÂØπcardlistÁöÑÂºïÁî®
                    const arr = [];
                    // ËÆ∞ÂΩïÁõ∏ÂêåÂùó‰ΩçÁΩÆ
                    tempList.forEach((element, i) => {
                        if (e.icon == tempList[i].icon) {
                            if (frist == -1) {
                                frist = i;
                            }
                            last = i;
                            arr.push(tempList[i]);
                        }
                    });
                    // Êª°‰∏â‰∏™Ê∂àÈô§
                    if (last - frist == 2) {
                        // Á¶ÅÊ≠¢ÁÇπÂáª
                        this.ing = true;
                        // Êí§ÈîÄÊï∞ÁªÑÊ∏ÖÁ©∫
                        this.revokeList = [];
                        // Á≠âÂæÖÂä®Áîª
                        setTimeout(() => {
                            arr.forEach((item) => {
                                item.isOut = true;
                            });
                            // ÈáçÊñ∞ÊéíÂ∫è
                            setTimeout(() => {
                                this.pendingAnimation();
                                this.ing = false;
                            }, 200);
                        }, 400);

                        tempList.splice(frist, 3);
                        this.curPieTotal -= 3;
                    }
                    // Ëµ¢
                    if (this.curPieTotal == 0) {
                        // Âà§Êñ≠ÊòØÂê¶‰ΩçÂÖ≥Âç°Ê®°Âºè
                        // console.log("Ê∏∏ÊàèËÉúÂà©");
                        setTimeout(() => {
                            if (this.menu.mode == 2) {
                                this.gameStatus = "next";
                            } else {
                                this.gameStatus = "success";
                            }
                            this.ing = true;
                            // Ê∏ÖÁ©∫ÂàóË°®ÈÅøÂÖçÊ∏≤ÊüìÂä®Áîª
                            this.cardList = [];
                        }, 500);
                    }
                    // Ëæì
                    if (this.pendingList.length === 7) {
                        this.ing = true;
                        setTimeout(() => {
                            this.gameStatus = "fail";
                        }, 500);
                        // console.log("Ê∏∏ÊàèÂ§±Ë¥•");
                    }
                },
                // remove ÁßªÂá∫
                remove() {
                    // ‰ªéÂâçÈù¢Êí§ÈîÄ
                    // console.log("ÁßªÂá∫");
                    if (!this.tools.remove) {
                        // console.log("Ê¨°Êï∞‰∏çË∂≥");
                        return;
                    }
                    if (!this.pendingList.length) {
                        // console.log("ÂàóÈòü‰∏∫Á©∫");
                        return;
                    }
                    // Ê¨°Êï∞Âáè‰∏Ä
                    this.tools.remove--;
                    // Êí§ÈîÄÊï∞ÁªÑÊ∏ÖÁ©∫
                    this.revokeList = [];
                    // Âõ∫ÂÆöyËΩ¥‰ΩçÁΩÆ
                    const offsetY = "456px";
                    // Âà§ÂÆöÂå∫Êï∞ÁªÑ
                    const tempList = this.pendingList;
                    // Ë¶ÅÂà†Èô§ÂÖÉÁ¥†ÁöÑ‰∏™Êï∞
                    let count = tempList.length > 3 ? 3 : tempList.length;
                    for (let i = 0; i < count; i++) {
                        tempList[i].isRemove = true;
                        tempList[i].isPending = false;
                        tempList[i].offsetY = offsetY;
                        tempList[i].offsetX = 96 + i * 48 + "px";
                        tempList[i].realOffsetX = tempList[i].offsetX;
                        tempList[i].realOffsetY = tempList[i].offsetY;
                    }
                    this.pendingList.splice(0, count);
                    this.pendingAnimation();
                },
                // Revoke Êí§ÈîÄ
                revoke() {
                    /*
                                ÁßªÈô§Âêé‰∏çËÉΩÊí§ÈîÄÔºå‰∏âÊ∂àÂêé‰∏çËÉΩÊí§ÈîÄ
                             */
                    // console.log("Êí§ÈîÄ");
                    // Êí§ÈîÄÊï∞ÁªÑ‰∏∫Á©∫
                    if (!this.revokeList.length || !this.tools.revoke) {
                        // console.log("ÂàóÈòü‰∏∫Á©∫");
                        if (!this.showRevokeTips) {
                            this.showRevokeTips = true;
                            setTimeout(() => {
                                this.showRevokeTips = false;
                            }, 2000);
                        }
                        return;
                    }
                    // Ê¨°Êï∞Âáè‰∏Ä
                    this.tools.revoke--;
                    const len = this.revokeList.length;
                    const p = this.revokeList[len - 1];
                    // ÁßªÂõûÂà∞Â∏ÉÂ±ÄÂå∫
                    p.offsetX = p.realOffsetX;
                    p.offsetY = p.realOffsetY;
                    p.isPending = false;

                    // Âà†Èô§ÊåáÂÆöÂÖÉÁ¥†
                    const index = this.pendingList.findIndex((item) => {
                        return item.cardId == p.cardId;
                    });
                    // ÈòüÂàóÂå∫ÁßªÈô§ÂÖÉÁ¥†
                    this.pendingList.splice(index, 1);
                    //
                    this.revokeList.pop();

                    this.pendingAnimation();
                    this.checkCover(p);
                },
                // Ê¥óÁâå
                shuffle() {
                    if (!this.tools.shuffle || this.ing) {
                        return;
                    }
                    this.ing = true;
                    // console.log("Êâì‰π±");
                    // Ê¨°Êï∞Âáè‰∏Ä
                    this.tools.shuffle--;
                    // ‰∏¥Êó∂‰øùÂ≠òÊâÄÊúâÂÖÉÁ¥†
                    const arr = [];
                    // Ëé∑ÂèñÊâÄÊúâÂÖÉÁ¥† x y
                    let count = 0;
                    this.cardList.forEach((element) => {
                        element.forEach((item) => {
                            // ÁßªÂá∫Âå∫ÂíåÂà§ÂÆöÂå∫Ë∑≥Ëøá
                            if (
                                item.isPending == false &&
                                item.isRemove == false &&
                                item.isOut == false
                            ) {
                                if (count > this.pieTotal - 50) {
                                    item.offsetX = "144px";
                                    item.offsetY = "216px";
                                } else {
                                    item.isOpacity = true;
                                }
                                count++;
                                arr.push(item.icon);
                            }
                        });
                    });
                    // Êâì‰π±Êï∞ÁªÑÈ°∫Â∫è
                    this.shuffleArray(arr);
                    // Êõ¥ÊîπÂéüÊï∞ÁªÑicon
                    let a = 0;
                    count = 0;
                    setTimeout(() => {
                        this.cardList.forEach((element) => {
                            element.forEach((item) => {
                                if (
                                    item.isPending == false &&
                                    item.isRemove == false &&
                                    item.isOut == false
                                ) {
                                    if (count > this.pieTotal - 50) {
                                        item.offsetX = item.realOffsetX;
                                        item.offsetY = item.realOffsetY;
                                    } else {
                                        item.isOpacity = false;
                                    }
                                    count++;
                                    item.icon = arr[a];
                                    a++;
                                }
                            });
                        });
                        setTimeout(() => {
                            this.ing = false;
                        }, 400);
                    }, 400);
                },
                getRandom(n, m) {
                    return Math.floor(Math.random() * (m - n + 1) + n);
                },
                shuffleArray(array) {
                    for (let i = array.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [array[i], array[j]] = [array[j], array[i]];
                    }
                    return array;
                },
            },
        });
    </script>
</body>

</html>